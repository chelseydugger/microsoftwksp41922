name: Deploy Contoso_University_Core

on:
 workflow_run:
  workflows: ["Pack Contoso_University_Core"]
  branches: [main]
  types:
    - completed
 workflow_dispatch:

jobs:
 deploy:
  runs-on: ubuntu-latest
  environment: production
  steps:
    - uses: dawidd6/action-download-artifact@v2
      with:
       workflow: pack-solution.yml
       name: packed-solution
    - uses: microsoft/powerplatform-actions/import-solution@v0
      with:
          environment-url: https://org0f39c1e2.crm.dynamics.com/main.aspx?appid=13b03e5d-bbbe-ec11-983f-00224808c6cc&pagetype=dashboard&id=eaa6e6bb-4712-ec11-b6e7-00224820f09b&type=system&_canOverride=true
          user-name: ${{ secrets.USERNAME }}
          password-secret: ${{ secrets.PASSWORD }}
          solution-file: contoso_university_core_managed.zip
